<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Generates fractal-like patterns based on an initial seed</title>
		<style>
			body: {
				background-color: black;
				color: white;
			}
		</style>
	</head>
	<body>
		<ul>
			<li>Generates a small N x N grid of numbers from 0 to 1</li>
			<li>Uses this to generate a N<sup>2</sup> x N<sup>2</sup> grid of numbers</li>
			<li>Uses this new grid to draw a pattern on the canvas</li>
			<li>(Will explain in greater detail later)</li>
		</ul>
		<br>
		<canvas id='c' width = 800 height = 600></canvas>
		
		<script>
			const canvas = document.querySelector('#c');
			
			const ctx = canvas.getContext('2d');
			
			const RandomNumbersArray = (w = 2, h = 2) => Array(h).fill(0).map( r => Array(w).fill(0).map( c => Math.random() ) );
			
			const idiv = (a, b) => Math.floor(a / b);
			
			const ArraySquare = (arr) => {
				let h = arr.length;
				let w = arr[0].length;
				let new_h = h * h;
				let new_w = w * w;
				
				return Array(new_h).fill(0).map(
					(_, r) => Array(new_w).fill(0).map(
						(_, c) => arr[r % h][c % w] * arr[ idiv(r, h) % h][ idiv(c, w) % w ]
					)
				);
			}
			
			const findGridMinMax = (arr) => { 
				let min = 1;
				let max = 0;
				
				for (let j = 0; j < arr.length; j++) {
					for (let i = 0; i < arr[0].length; i++) {
						let x = arr[j][i];
						
						min = (x < min)? x : min;
						max = (x > max)? x : max;
					}
				}
				let range = max - min;
				
				return {Min: min, Max: max, Range: range};
			}
			
			const mapRange = (value, range1_min, range1_max, range2_min, range2_max) => range2_min + ( ( (value - range1_min) / (range1_max - range1_min) ) * (range2_max - range2_min) );
			
			
			const drawGrid = (arr) => {
				let x = findGridMinMax(arr);
				let max = x.Max;
				let min = x.Min;
				let range = x.Range;
				let shade = 255;
				let val = 1;
			
				arr.map( (_, r) => arr[r].map( (_,c) =>
					{
						val = arr[r][c];
						shade = mapRange(val, min, max, 0, 255);
						
						ctx.fillStyle = `rgb(${shade},${shade},${shade})`
						ctx.fillRect(r*1, c*1, 1, 1);
					}
				));
			}
			
			const doThing = () => {
				let arr = RandomNumbersArray(5,5);
				arr =  ArraySquare( ArraySquare(arr) );
				
				drawGrid(arr);
			}
			
			doThing();
		</script>
	</body>
</html>
